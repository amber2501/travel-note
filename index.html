<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>æ—…éŠè¡Œç¨‹è¦åŠƒ App - å®Œæ•´ç‰ˆ</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://unpkg.com/vue@3/dist/vue.global.prod.js"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css">
    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+TC:wght@300;400;500;700&display=swap" rel="stylesheet">
    <style>
        /* CSS ä¿æŒä¸è®Šï¼Œç¶­æŒæ¥µç°¡é¢¨æ ¼å’Œ App ä½ˆå±€ */
        body { background-color: #f7f7f7; font-family: 'Noto Sans TC', sans-serif; }
        #app { height: 100vh; display: flex; flex-direction: column; overflow: hidden; }
        .mobile-container { max-width: 450px; margin: 0 auto; border: 1px solid #e0e0e0; }
        .content-area { flex-grow: 1; overflow-y: auto; padding-bottom: 70px; } /* åº•éƒ¨ç•™ç©ºé–“çµ¦æµ®å‹•æŒ‰éˆ• */

        /* æ—¥æœŸé¸å–®æ¨£å¼ */
        .date-slider { overflow-x: scroll; scroll-snap-type: x mandatory; -webkit-overflow-scrolling: touch; }
        .date-item { min-width: 60px; scroll-snap-align: start; }
        .date-item span:first-child { font-size: 0.9rem; } /* æ˜ŸæœŸå­—é«”å¤§ */
        .date-item span:last-child { font-size: 1.5rem; line-height: 1; } /* æ—¥æœŸæ•¸å­—å­—é«”å¤§ */

        /* æµ®å‹• Tab å°èˆªæŒ‰éˆ• (ä¾ç…§è¦æ±‚å®šä½åœ¨é é¦–å³ä¸‹æ–¹ï¼Œæµ®åœ¨åœ–ç‰‡ä¸Šæ–¹) */
        .tab-nav {
            position: absolute;
            top: 10px; /* è·é›¢é ‚éƒ¨ */
            right: 10px; /* è·é›¢å³é‚Š */
            z-index: 50; /* ç¢ºä¿æµ®åœ¨åœ–ç‰‡/åœ°åœ–ä¸Šæ–¹ */
            background-color: rgba(255, 255, 255, 0.9); /* åŠé€æ˜èƒŒæ™¯ */
            border-radius: 9999px; /* åœ“è§’è† å›Š */
            box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1), 0 2px 4px -2px rgba(0, 0, 0, 0.06);
            padding: 4px;
        }

        /* æµ®å‹•æ–°å¢æŒ‰éˆ• */
        .fab-button {
            position: fixed;
            bottom: 20px;
            right: 20px;
            z-index: 40;
            width: 56px;
            height: 56px;
            font-size: 28px;
        }
    </style>
    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+TC:wght@300;400;500;700&display=swap" rel="stylesheet">
</head>
<body>

<div id="app" class="mobile-container bg-white">
    <header class="bg-white p-4 border-b border-gray-200 text-gray-800 relative">
        <h1 class="text-xl font-medium text-center tracking-wider text-blue-600">
            {{ tabs.find(t => t.id === activeTab).label }}
        </h1>
        
        <div v-if="activeTab === 'schedule'" id="map" class="h-64 w-full bg-gray-200 flex items-center justify-center text-gray-500 border-b border-gray-300">
            Google Map å€åŸŸ
        </div>

        <div class="tab-nav flex space-x-2">
            <button 
                v-for="tab in tabs" 
                :key="tab.id"
                @click="activeTab = tab.id" 
                :class="{'bg-blue-600 text-white': activeTab === tab.id, 'bg-gray-200 text-gray-600': activeTab !== tab.id}"
                class="w-10 h-10 flex items-center justify-center rounded-full transition-colors"
                :title="tab.label"
            >
                <i :class="tab.icon"></i>
            </button>
        </div>
    </header>

    <div class="content-area">
        
        <div v-if="activeTab === 'schedule'" class="p-4">
            
            <div class="p-3 bg-blue-50 border-l-4 border-blue-400 rounded-md mb-4 flex justify-between items-center text-sm">
                <p class="text-blue-700 font-medium">â˜€ï¸ æ™´æœ— 28Â°C (é«”æ„Ÿ 30Â°C)</p>
                <i class="fas fa-cloud-sun text-xl text-blue-500"></i>
            </div>
            
            <div class="date-slider flex space-x-4 pb-2 mb-4 border-b border-gray-200">
                <button v-for="date in dates" :key="date.fullDate" class="date-item flex flex-col items-center p-2 rounded-lg transition-colors"
                    :class="{'bg-blue-100 text-blue-700 font-bold': date.isActive, 'text-gray-600 hover:bg-gray-100': !date.isActive}">
                    <span class="font-bold">{{ date.dayOfWeek }}</span>
                    <span class="font-extrabold">{{ date.dayOfMonth }}</span>
                </button>
            </div>
            
            <ul class="space-y-4">
                <template v-for="(item, index) in itinerary" :key="item.id">
                    <div v-if="index > 0" class="flex items-center text-sm text-gray-500 my-1 ml-4 border-l-2 border-dashed pl-2">
                        <i class="fas fa-car mr-2"></i> <span>{{ item.travelTime }} (é–‹è»Š)</span>
                    </div>

                    <li v-if="index === 0 && item.category === 'èˆªç­'" 
                        class="p-4 bg-yellow-50 border-l-4 border-yellow-500 shadow-sm rounded-lg cursor-pointer hover:bg-yellow-100 transition-shadow"
                        @click="showEditModal(item)">
                        <h3 class="text-lg font-bold text-yellow-800"><i class="fas fa-plane-departure mr-2"></i> {{ item.name }}</h3>
                        <p class="text-sm">èˆªç­ç·¨è™Ÿ: {{ item.flightNumber }}</p>
                        <div class="flex justify-between text-xs mt-1">
                            <span>èµ·é£›: {{ item.departureTime }}</span>
                            <span>æŠµé”: {{ item.arrivalTime }}</span>
                        </div>
                        <p class="text-right text-xs text-gray-500 mt-2">(é»æ“Šè·³è½‰ Google Map - (9))</p>
                    </li>

                    <li v-else 
                        class="bg-white p-4 shadow-md rounded-lg border-l-4 border-blue-500 cursor-grab hover:shadow-lg transition-shadow" 
                        @click="showEditModal(item)">
                        
                        <h3 class="text-lg font-bold text-gray-800">{{ item.name }}</h3>
                        <p v-if="item.businessHours" class="text-sm text-gray-600"><i class="far fa-clock mr-1"></i> ç‡Ÿæ¥­æ™‚é–“: {{ item.businessHours }}</p>
                        <p v-if="item.ticketPrice" class="text-sm text-gray-600"><i class="fas fa-ticket-alt mr-1"></i> é–€ç¥¨: {{ item.ticketPrice }} JPY</p>
                        <p class="text-sm mt-2">å‚™è¨»: {{ item.notes }}</p>
                        <p class="text-right text-xs text-gray-500 mt-2">(é»æ“Šè·³è½‰ Google Map - (9))</p>
                    </li>
                </template>
            </ul>
        </div>
        
        <div v-else-if="activeTab === 'info'" class="p-4 space-y-4">
            <h2 class="text-xl font-bold text-blue-600">â„¹ï¸ æ—…éŠè³‡è¨Š</h2>

            <div class="p-4 bg-gray-50 rounded-lg border border-gray-200">
                <h3 class="text-lg font-semibold mb-3">åŒ¯ç‡æ›ç®— (JPY â†’ TWD)</h3>
                <div class="flex space-x-3 mb-2">
                    <input type="number" v-model="jpyAmount" placeholder="æ—¥å¹£é‡‘é¡" class="p-2 border rounded-lg w-1/2 focus:ring-blue-500">
                    <span class="text-2xl">â†’</span>
                    <input type="text" :value="twdAmount" readonly class="p-2 border rounded-lg w-1/2 bg-white font-bold text-blue-600">
                </div>
                <p class="text-sm text-gray-500">ç•¶æ—¥åŒ¯ç‡ (1 JPY â‰ˆ 0.22 TWD - æ¨¡æ“¬)</p>
            </div>

            <div class="p-4 bg-gray-50 rounded-lg border border-gray-200">
                <h3 class="text-lg font-semibold mb-2"><i class="fas fa-plane mr-2"></i> èˆªç­è³‡è¨Š</h3>
                <div v-for="f in flightInfo" :key="f.type" class="mb-2 p-2 border-b">
                    <p class="font-medium">{{ f.type }}</p>
                    <p class="text-sm">å¾ {{ f.departureAirport }} è‡³ {{ f.arrivalAirport }}</p>
                    <p class="text-xs">èµ·é£›: {{ f.departureTime }} | æŠµé”: {{ f.arrivalTime }} | é£›è¡Œæ™‚é–“: {{ f.flightDuration }}</p>
                    <p class="text-xs text-blue-500">èˆªç­ç·¨è™Ÿ: {{ f.flightNumber }}</p>
                </div>
            </div>

            <div class="p-4 bg-gray-50 rounded-lg border border-gray-200">
                <h3 class="text-lg font-semibold mb-2"><i class="fas fa-hotel mr-2"></i> ä½å®¿èˆ‡ç§Ÿè»Š</h3>
                <p class="font-medium">é£¯åº—: {{ accommodation.name }}</p>
                <p class="text-sm">åœ°å€: {{ accommodation.address }} (<a :href="accommodation.navLink" target="_blank" class="text-blue-500 hover:underline">å°èˆª</a>)</p>
                <p class="mt-3 font-medium">ç§Ÿè»Š: {{ rental.company }}</p>
                <p class="text-sm">å–è»Šè™•: {{ rental.location }} (<a :href="rental.navLink" target="_blank" class="text-blue-500 hover:underline">å°èˆª</a>)</p>
            </div>
            
            <div class="p-4 bg-red-50 rounded-lg border border-red-200">
                <h3 class="text-lg font-semibold mb-2 text-red-700"><i class="fas fa-ambulance mr-2"></i> ç·Šæ€¥é€£çµ¡</h3>
                <p class="text-sm">è­¦å¯Ÿ: 110 (ç•¶åœ°è™Ÿç¢¼)</p>
                <p class="text-sm">æ•‘è­·è»Š: 119 (ç•¶åœ°è™Ÿç¢¼)</p>
            </div>
        </div>

        <div v-else-if="activeTab === 'shopping'" class="p-4">
            <h2 class="text-xl font-bold text-blue-600">ğŸ§º è³¼ç‰©æ¸…å–®</h2>
            <ul class="space-y-3 mt-4">
                <li v-for="item in shoppingList" :key="item.id" class="flex items-center p-3 bg-white shadow-sm rounded-md border-l-4 border-blue-400">
                    <span class="flex-grow font-medium text-gray-700">{{ item.name }}</span>
                    <span v-if="item.image" class="text-xs bg-green-100 text-green-700 px-2 py-1 rounded-full">å·²ä¸Šå‚³åœ–</span>
                    <span v-else class="text-xs text-gray-400">ç„¡åœ–</span>
                </li>
            </ul>
            <p v-if="shoppingList.length === 0" class="text-center text-gray-400 mt-8 text-sm">è«‹æ–°å¢æƒ³è²·çš„ç‰©å“</p>
        </div>
        
        <div v-else-if="activeTab === 'expense'" class="p-4">
            <div class="bg-indigo-600 text-white p-4 rounded-lg mb-4 flex justify-between items-center">
                <h2 class="text-lg font-medium">ç¸½èŠ±è²»</h2>
                <span class="text-3xl font-extrabold">{{ totalExpense.toLocaleString() }} JPY</span>
            </div>

            <ul class="space-y-3">
                <li v-for="item in expenseRecords" :key="item.id" class="bg-white p-3 rounded-md shadow flex justify-between items-center border-l-4 border-indigo-400">
                    <div>
                        <p class="font-semibold">{{ item.name }} (<span class="text-xs text-indigo-500">{{ item.category }}</span>)</p>
                        <p class="text-xs text-gray-500">{{ item.date }} | {{ item.paymentMethod }}</p>
                    </div>
                    <span class="font-bold text-red-600">{{ item.amount.toLocaleString() }} JPY</span>
                </li>
            </ul>
            <p v-if="expenseRecords.length === 0" class="text-center text-gray-400 mt-8 text-sm">è«‹æ–°å¢èŠ±è²»è¨˜éŒ„</p>
        </div>
    </div>
    
    <button 
        v-if="['schedule', 'shopping', 'expense'].includes(activeTab)"
        @click="showAddModal(activeTab)"
        class="fab-button bg-blue-600 hover:bg-blue-700 text-white rounded-full shadow-xl transition-transform transform hover:scale-105 flex items-center justify-center"
        title="æ–°å¢é …ç›®"
    >
        <i class="fas fa-plus"></i>
    </button>


    <div v-if="isModalOpen" class="fixed inset-0 bg-black bg-opacity-50 z-50 flex items-center justify-center p-4">
        <div class="bg-white rounded-lg shadow-2xl w-full max-w-sm p-6">
            <h3 class="text-xl font-bold mb-4">æ–°å¢/ç·¨è¼¯é …ç›®</h3>
            
            <div v-if="currentModalType === 'schedule'" class="mb-4">
                <label class="block text-sm font-medium text-gray-700">åˆ†é¡</label>
                <select class="mt-1 block w-full p-2 border border-gray-300 rounded-md">
                    <option>æ™¯é»</option>
                    <option>ä½å®¿</option>
                    <option>ç¾é£Ÿ</option>
                    <option>è³¼ç‰©</option>
                    <option>èˆªç­</option>
                    <option>å…¶ä»–</option>
                </select>
            </div>
            
            <input type="text" placeholder="åç¨±/å…§å®¹..." class="w-full p-2 border rounded-md mb-4">
            
            <div v-if="isEditing" class="flex justify-between mt-4">
                <button @click="confirmDelete" class="bg-red-500 hover:bg-red-600 text-white font-medium py-2 px-4 rounded-md">
                    <i class="fas fa-trash-alt mr-1"></i> åˆªé™¤
                </button>
                <button @click="closeModal" class="bg-blue-600 hover:bg-blue-700 text-white font-medium py-2 px-4 rounded-md">
                    å„²å­˜
                </button>
            </div>
            <div v-else class="flex justify-end mt-4">
                 <button @click="closeModal" class="bg-blue-600 hover:bg-blue-700 text-white font-medium py-2 px-4 rounded-md">
                    å„²å­˜
                </button>
            </div>
        </div>
    </div>
    
    <div v-if="isConfirmDeleteOpen" class="fixed inset-0 bg-black bg-opacity-60 z-50 flex items-center justify-center">
        <div class="bg-white rounded-lg shadow-2xl w-full max-w-xs p-6 text-center">
            <h4 class="text-lg font-bold text-red-600 mb-4">âš ï¸ ç¢ºå®šåˆªé™¤å—ï¼Ÿ</h4>
            <p class="text-sm text-gray-600 mb-6">æ­¤æ“ä½œç„¡æ³•å¾©åŸã€‚</p>
            <div class="flex justify-between space-x-4">
                <button @click="isConfirmDeleteOpen = false" class="flex-1 border border-gray-300 py-2 rounded-md hover:bg-gray-100">å–æ¶ˆ</button>
                <button @click="handleDelete" class="flex-1 bg-red-500 hover:bg-red-600 text-white py-2 rounded-md">ç¢ºèªåˆªé™¤</button>
            </div>
        </div>
    </div>

</div>

<script async defer src="https://maps.googleapis.com/maps/api/js?key=YOUR_GOOGLE_MAPS_API_KEY&libraries=places&callback=initMap"></script>

<script>
    const { createApp, ref, computed } = Vue;

    // æ¨¡æ“¬ Google åœ°åœ–åˆå§‹åŒ–å‡½æ•¸ (ä¿æŒåŸæœ‰çš„å‡½å¼åç¨±)
    window.initMap = () => {
        console.log("Google Maps åˆå§‹åŒ–å®Œæˆ (æœ¬æ¬¡ç¯„ä¾‹åƒ…ç‚ºæ¨¡æ“¬)");
    };

    const app = createApp({
        setup() {
            // --- æ ¸å¿ƒç‹€æ…‹ ---
            const activeTab = ref('schedule'); // ç•¶å‰åˆ†é 
            const isModalOpen = ref(false);    // æ–°å¢/ç·¨è¼¯å½ˆçª—ç‹€æ…‹
            const isEditing = ref(false);      // åˆ¤æ–·æ˜¯å¦ç‚ºç·¨è¼¯æ¨¡å¼
            const isConfirmDeleteOpen = ref(false); // åˆªé™¤ç¢ºèªå½ˆçª—
            const currentModalType = ref(''); // è¨˜éŒ„ç›®å‰æ˜¯å“ªå€‹åŠŸèƒ½çš„ Modal

            // --- æ¨¡æ“¬æ•¸æ“š ---
            const tabs = [
                { id: 'schedule', label: 'æ¯æ—¥è¡Œç¨‹è¡¨', icon: 'fas fa-map-marker-alt' },
                { id: 'info', label: 'è³‡è¨Š', icon: 'fas fa-info-circle' },
                { id: 'shopping', label: 'è³¼ç‰©æ¸…å–®', icon: 'fas fa-shopping-basket' },
                { id: 'expense', label: 'èŠ±è²»', icon: 'fas fa-coins' },
            ];
            
            // æ¨¡æ“¬æ¯æ—¥è¡Œç¨‹æ•¸æ“š
            const itinerary = ref([
                { id: 1, name: 'æ¡ƒåœ’åœ‹éš›æ©Ÿå ´ (TPE) - å•Ÿç¨‹', category: 'èˆªç­', travelTime: null, departureTime: '09:00', arrivalTime: '13:00', flightNumber: 'BR198' }, // ç¬¬ä¸€å€‹è¡Œç¨‹
                { id: 2, name: 'æˆç”°æ©Ÿå ´å–è»Š', category: 'å…¶ä»–', travelTime: '1å°æ™‚ 30åˆ†é˜', businessHours: '08:00-20:00', notes: 'ç§Ÿè»Šå…¬å¸æ«ƒæª¯åœ¨ç¬¬äºŒèˆªå»ˆ' },
                { id: 3, name: 'æ±äº¬ç£å¸Œçˆ¾é “é£¯åº—', category: 'ä½å®¿', travelTime: '40åˆ†é˜', businessHours: 'å…¨å¤©', notes: 'ææ—© Check-in' },
                { id: 4, name: 'æ±äº¬è¿ªå£«å°¼æ¨‚åœ’', category: 'æ™¯é»', travelTime: '10åˆ†é˜', businessHours: '09:00-21:00', ticketPrice: '8900', notes: 'è¨˜å¾—è²·å¿«é€Ÿé€šé—œ' },
            ]);

            // æ¨¡æ“¬æ—¥æœŸé¸å–®æ•¸æ“š (ç•¶æ—¥ç‚º Fri 6)
            const dates = ref([
                { dayOfWeek: 'Thu', dayOfMonth: 5, fullDate: '2025-12-05', isActive: false },
                { dayOfWeek: 'Fri', dayOfMonth: 6, fullDate: '2025-12-06', isActive: true },
                { dayOfWeek: 'Sat', dayOfMonth: 7, fullDate: '2025-12-07', isActive: false },
                { dayOfWeek: 'Sun', dayOfMonth: 8, fullDate: '2025-12-08', isActive: false },
                { dayOfWeek: 'Mon', dayOfMonth: 9, fullDate: '2025-12-09', isActive: false },
            ]);

            // æ¨¡æ“¬è³‡è¨Šé æ•¸æ“š
            const flightInfo = ref([
                { type: 'å»ç¨‹', departureAirport: 'TPE', arrivalAirport: 'NRT', departureTime: '09:00', arrivalTime: '13:00', flightDuration: '3hr', flightNumber: 'BR198' },
                { type: 'å›ç¨‹', departureAirport: 'NRT', arrivalAirport: 'TPE', departureTime: '18:00', arrivalTime: '21:00', flightDuration: '3hr', flightNumber: 'BR197' },
            ]);
            const accommodation = ref({ name: 'æ±äº¬ç£å¸Œçˆ¾é “é£¯åº—', address: 'åƒè‘‰ç¸£èˆæ¿±', navLink: '#' });
            const rental = ref({ company: 'Toyota Rent a Car', location: 'æˆç”°æ©Ÿå ´åº—', navLink: '#' });

            // æ¨¡æ“¬è³¼ç‰©æ¸…å–®æ•¸æ“š
            const shoppingList = ref([
                { id: 101, name: 'è–¯æ¢ä¸‰å…„å¼Ÿ', image: true },
                { id: 102, name: 'é™å®šé‹¼å½ˆæ¨¡å‹', image: false },
            ]);

            // æ¨¡æ“¬èŠ±è²»æ•¸æ“š
            const expenseRecords = ref([
                { id: 201, category: 'äº¤é€š', name: 'NEX è»Šç¥¨', date: '2025-12-06', amount: 4070, paymentMethod: 'ä¿¡ç”¨å¡' },
                { id: 202, category: 'é¤é£²', name: 'æ‹‰éºµåˆé¤', date: '2025-12-06', amount: 1500, paymentMethod: 'ç¾é‡‘' },
            ]);


            // --- é‹ç®—å±¬æ€§ (Computed Properties) ---
            
            // åŒ¯ç‡æ›ç®—é‚è¼¯
            const jpyAmount = ref(10000);
            const exchangeRate = 0.22; // æ¨¡æ“¬ç•¶æ—¥åŒ¯ç‡
            const twdAmount = computed(() => {
                return (jpyAmount.value * exchangeRate).toFixed(0);
            });
            
            // ç¸½èŠ±è²»è¨ˆç®—
            const totalExpense = computed(() => {
                return expenseRecords.value.reduce((sum, item) => sum + item.amount, 0);
            });


            // --- æ–¹æ³• (Methods) ---
            
            const showAddModal = (type) => {
                isEditing.value = false;
                currentModalType.value = type;
                isModalOpen.value = true;
            };

            const showEditModal = (item) => {
                isEditing.value = true;
                currentModalType.value = 'schedule'; // å‡è¨­å¾è¡Œç¨‹å¡ç‰‡é€²å…¥ç·¨è¼¯
                isModalOpen.value = true;
                // é€™è£¡æ‡‰è©²è¼‰å…¥ item æ•¸æ“šåˆ°è¡¨å–®
            };

            const closeModal = () => {
                isModalOpen.value = false;
                isEditing.value = false;
            };
            
            const confirmDelete = () => {
                isModalOpen.value = false;
                isConfirmDeleteOpen.value = true;
            };

            const handleDelete = () => {
                // åŸ·è¡Œåˆªé™¤é‚è¼¯ (ä¾‹å¦‚ï¼šå¾ itinerary.value ä¸­ç§»é™¤)
                alert('é …ç›®å·²åˆªé™¤ï¼ (æ¨¡æ“¬)');
                isConfirmDeleteOpen.value = false;
            };


            return {
                activeTab,
                tabs,
                itinerary,
                dates,
                flightInfo,
                jpyAmount,
                twdAmount,
                totalExpense,
                expenseRecords,
                shoppingList,
                accommodation,
                rental,
                isModalOpen,
                isEditing,
                isConfirmDeleteOpen,
                currentModalType,
                showAddModal,
                showEditModal,
                closeModal,
                confirmDelete,
                handleDelete
            };
        }
    });

    app.mount('#app');
</script>

</body>
</html>
