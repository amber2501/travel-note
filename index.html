<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>æ—…éŠè¡Œç¨‹è¦åŠƒ</title>
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="default">
    
    <!-- å¼•å…¥å­—é«” -->
    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+TC:wght@300;400;500;700&display=swap" rel="stylesheet">

    <style>
        :root {
            --primary: #89CFF0;    /* æ°´è—è‰² */
            --primary-dark: #4FC3F7;
            --bg: #F5F7FA;
            --card: #FFFFFF;
            --text-main: #455A64;
            --text-light: #90A4AE;
            --danger: #FF8A80;
            --nav-height: 60px;
        }

        * { box-sizing: border-box; -webkit-tap-highlight-color: transparent; }
        
        body {
            margin: 0; padding: 0;
            font-family: 'Noto Sans TC', sans-serif;
            background: var(--bg);
            color: var(--text-main);
            padding-bottom: calc(var(--nav-height) + 80px); /* é ç•™åº•éƒ¨ç©ºé–“ */
            -webkit-overflow-scrolling: touch;
        }

        /* --- éš±è—/é¡¯ç¤ºæ§åˆ¶ --- */
        .hidden { display: none !important; }
        
        /* --- æŒ‰éˆ•èˆ‡è¼¸å…¥æ¡† --- */
        .btn {
            border: none; border-radius: 8px;
            padding: 12px 16px; font-size: 1rem;
            cursor: pointer; transition: 0.2s;
            display: flex; align-items: center; justify-content: center;
        }
        .btn-primary { background: var(--primary); color: white; width: 100%; box-shadow: 0 4px 10px rgba(137, 207, 240, 0.3); }
        .btn-icon { background: transparent; color: #CFD8DC; font-size: 1.5rem; padding: 5px; }
        .btn-icon:active { color: var(--danger); }
        
        input, select {
            width: 100%; padding: 12px;
            border: 1px solid #ECEFF1; border-radius: 8px;
            background: #FAFAFA; font-size: 16px; outline: none;
            margin-bottom: 12px;
            -webkit-appearance: none; /* iOS å„ªåŒ– */
        }
        input:focus { border-color: var(--primary); background: #FFF; }

        /* --- åˆå§‹è¨­å®šé  --- */
        #setup-view {
            height: 100vh; display: flex; flex-direction: column;
            justify-content: center; padding: 40px; text-align: center;
            background: white; z-index: 2000; position: fixed; top: 0; left: 0; width: 100%;
        }

        /* --- é ‚éƒ¨å›ºå®šå€ --- */
        .sticky-header {
            position: sticky; top: 0; z-index: 100;
            background: var(--bg);
            padding-top: env(safe-area-inset-top);
            box-shadow: 0 2px 10px rgba(0,0,0,0.03);
        }
        
        .header-title {
            padding: 15px 20px 5px; 
            font-size: 1.2rem; font-weight: bold; 
            color: var(--primary);
            display: flex; justify-content: space-between; align-items: center;
        }

        .day-scroller {
            display: flex; overflow-x: auto;
            padding: 10px 15px; gap: 10px;
            scrollbar-width: none;
        }
        .day-scroller::-webkit-scrollbar { display: none; }
        
        .day-chip {
            flex: 0 0 auto;
            padding: 8px 16px; border-radius: 20px;
            background: white; color: var(--text-light);
            border: 1px solid transparent; font-size: 0.9rem;
            transition: 0.3s; cursor: pointer;
            display: flex; flex-direction: column; align-items: center;
        }
        .day-chip span.date { font-size: 0.7rem; margin-top: 2px; }
        .day-chip.active {
            background: var(--primary); color: white;
            box-shadow: 0 2px 8px rgba(137, 207, 240, 0.4);
            font-weight: 500;
        }

        /* --- åˆ—è¡¨å¡ç‰‡ --- */
        .container { padding: 15px; }
        .card {
            background: var(--card); border-radius: 12px;
            padding: 16px; margin-bottom: 15px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.03);
        }
        
        .tag {
            display: inline-block; padding: 2px 8px;
            border-radius: 4px; font-size: 0.75rem;
            margin-bottom: 6px; color: #555;
        }
        /* æ¨™ç±¤é¡è‰² */
        .tag.flight { background: #E3F2FD; color: #1565C0; }
        .tag.food { background: #FFF3E0; color: #EF6C00; }
        .tag.hotel { background: #E8F5E9; color: #2E7D32; }
        .tag.transport { background: #F3E5F5; color: #7B1FA2; }
        .tag.spot { background: #FCE4EC; color: #C2185B; }
        .tag.shop { background: #FFF8E1; color: #FBC02D; }
        .tag.fun { background: #E0F2F1; color: #00695C; }
        .tag.other { background: #ECEFF1; color: #455A64; }

        .item-row { display: flex; justify-content: space-between; align-items: flex-start; }
        .item-main { flex: 1; padding-right: 10px; }
        .item-time { font-weight: 700; color: var(--primary); margin-right: 12px; font-size: 0.95rem; min-width: 45px;}
        .item-title { font-size: 1rem; font-weight: 500; margin: 0 0 4px 0; color: #37474F; }
        .item-sub { font-size: 0.85rem; color: var(--text-light); display: flex; align-items: center; gap: 5px; }
        .location-link { color: var(--primary); text-decoration: none; display: flex; align-items: center; }

        /* --- åº•éƒ¨å°èˆª --- */
        .bottom-nav {
            position: fixed; bottom: 0; left: 0; width: 100%;
            height: var(--nav-height); background: white;
            display: flex; justify-content: space-around; align-items: center;
            border-top: 1px solid #EEE; z-index: 1000;
            padding-bottom: env(safe-area-inset-bottom);
        }
        .nav-item {
            text-align: center; color: #B0BEC5; font-size: 0.7rem;
            background: none; border: none; padding: 5px; flex: 1;
        }
        .nav-item.active { color: var(--primary); font-weight: 700; }
        .nav-icon { font-size: 1.4rem; display: block; margin-bottom: 2px; }

        /* --- æµ®å‹•æŒ‰éˆ• FAB --- */
        .fab {
            position: fixed; bottom: calc(var(--nav-height) + 20px); right: 20px;
            width: 56px; height: 56px; border-radius: 50%;
            background: var(--primary); color: white;
            font-size: 28px; display: flex; align-items: center; justify-content: center;
            box-shadow: 0 4px 15px rgba(137, 207, 240, 0.6);
            z-index: 900; border: none; cursor: pointer;
        }
        .fab:active { transform: scale(0.95); }

        /* --- å½ˆå‡ºè¦–çª— Modal --- */
        .modal {
            position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            background: rgba(0,0,0,0.5); z-index: 1100;
            display: flex; align-items: center; justify-content: center;
            backdrop-filter: blur(2px);
        }
        .modal-content {
            background: white; width: 85%; max-width: 400px;
            padding: 24px; border-radius: 20px;
            animation: popUp 0.3s cubic-bezier(0.175, 0.885, 0.32, 1.275);
            box-shadow: 0 10px 25px rgba(0,0,0,0.1);
        }
        @keyframes popUp { from { transform: scale(0.9); opacity: 0; } to { transform: scale(1); opacity: 1; } }
        .modal h3 { margin-top: 0; color: var(--primary); text-align: center; }

        /* --- æ¸…å–® Checkbox --- */
        .check-item {
            display: flex; align-items: center; padding: 12px 0;
            border-bottom: 1px solid #F0F0F0;
        }
        .check-item input[type="checkbox"] { width: 22px; height: 22px; margin: 0 15px 0 0; }
        .check-item.checked span { text-decoration: line-through; color: #CFD8DC; }
    </style>
</head>
<body>

    <!-- 0. åˆå§‹è¨­å®šé  -->
    <div id="setup-view" class="hidden">
        <h2 style="color: var(--primary); font-size: 1.8rem;">æ—…ã€‚è¨ˆç•« âœˆï¸</h2>
        <p style="color: #999; margin-bottom: 40px;">æ¥µç°¡é¢¨æ ¼çš„æ—…è¡ŒåŠ©æ‰‹</p>
        
        <div style="text-align: left; width: 100%; max-width: 300px; margin: 0 auto;">
            <label style="color: #666; font-size: 0.9rem; margin-bottom: 5px; display: block;">å‡ºç™¼æ—¥æœŸ</label>
            <input type="date" id="setup-date">
            
            <label style="color: #666; font-size: 0.9rem; margin-bottom: 5px; display: block;">æ—…è¡Œå¤©æ•¸</label>
            <input type="number" id="setup-days" placeholder="ä¾‹å¦‚: 5" value="3" inputmode="numeric">
        </div>
        
        <button class="btn btn-primary" onclick="finishSetup()" style="margin-top: 30px;">é–‹å§‹è¦åŠƒ</button>
    </div>

    <!-- 1. è¡Œç¨‹é é¢ -->
    <div id="view-itinerary" class="view-section">
        <div class="sticky-header">
            <div class="header-title">è¡Œç¨‹è¦åŠƒ</div>
            <div class="day-scroller" id="day-tabs-itinerary"></div>
        </div>
        <div class="container" id="list-itinerary"></div>
        <button class="fab" onclick="openModal('itinerary')">ï¼‹</button>
    </div>

    <!-- 2. è¨˜å¸³é é¢ -->
    <div id="view-money" class="view-section hidden">
        <div class="sticky-header">
            <div class="header-title">
                <span>æ—…è²»è¨˜å¸³</span>
                <span style="font-size:0.9rem; font-weight:normal;">ç•¶æ—¥: <b style="color:var(--text-main); font-size:1.1rem;" id="day-total">$0</b></span>
            </div>
            <div class="day-scroller" id="day-tabs-money"></div>
        </div>
        <div class="container" id="list-money"></div>
        <button class="fab" onclick="openModal('money')">ï¼‹</button>
    </div>

    <!-- 3. æ¸…å–®é é¢ -->
    <div id="view-packing" class="view-section hidden">
        <div class="sticky-header">
            <div class="header-title">è¡Œå‰æº–å‚™ ğŸ’</div>
        </div>
        <div class="container">
            <div style="background: white; padding: 15px; border-radius: 12px; margin-bottom: 20px; box-shadow: 0 2px 8px rgba(0,0,0,0.03);">
                <div style="display:flex; gap:10px;">
                    <input type="text" id="pack-input" placeholder="æ–°å¢å¾…è¾¦äº‹é …..." style="margin-bottom:0;">
                    <button class="btn btn-primary" style="width:auto; padding: 0 20px;" onclick="addPackItem()">æ–°å¢</button>
                </div>
            </div>
            
            <div id="list-packing" style="background: white; padding: 0 15px; border-radius: 12px; min-height: 100px;"></div>
            
            <div style="margin-top: 50px; text-align: center;">
                <button onclick="resetTrip()" style="background:transparent; border:1px solid #ddd; color:#999; padding:8px 20px; border-radius:20px; font-size: 0.8rem;">âš  é‡ç½®æ‰€æœ‰è³‡æ–™</button>
            </div>
        </div>
    </div>

    <!-- Modal: æ–°å¢è¡Œç¨‹ -->
    <div id="modal-itinerary" class="modal hidden">
        <div class="modal-content">
            <h3>æ–°å¢è¡Œç¨‹</h3>
            <div style="display:flex; gap:10px;">
                <input type="time" id="i-time" style="width:40%">
                <select id="i-type" style="width:60%">
                    <option value="spot">æ™¯é» ğŸ—»</option>
                    <option value="food">é¤å»³ ğŸ´</option>
                    <option value="transport">äº¤é€š ğŸšƒ</option>
                    <option value="flight">èˆªç­ âœˆï¸</option>
                    <option value="hotel">ä½å®¿ ğŸ¨</option>
                    <option value="shop">è³¼ç‰© ğŸ›ï¸</option>
                </select>
            </div>
            <input type="text" id="i-title" placeholder="åç¨± (ä¾‹: æ¸…æ°´å¯º)">
            <input type="text" id="i-loc" placeholder="åœ°é» (é»æ“Šå¾Œé–‹å•Ÿåœ°åœ–)">
            
            <div style="display:flex; gap:10px; margin-top:10px;">
                <button class="btn" style="background:#F5F5F5; color:#666; flex:1;" onclick="closeModal('itinerary')">å–æ¶ˆ</button>
                <button class="btn btn-primary" style="flex:1;" onclick="saveItinerary()">å„²å­˜</button>
            </div>
        </div>
    </div>

    <!-- Modal: æ–°å¢è¨˜å¸³ -->
    <div id="modal-money" class="modal hidden">
        <div class="modal-content">
            <h3>è¨˜ä¸€ç­†</h3>
            <input type="text" id="m-title" placeholder="é …ç›® (ä¾‹: æ‹‰éºµ)">
            <div style="display:flex; gap:10px;">
                <input type="number" id="m-cost" placeholder="é‡‘é¡" style="flex:1" inputmode="numeric">
                <select id="m-cat" style="flex:1">
                    <option value="food">é£²é£Ÿ ğŸ±</option>
                    <option value="transport">äº¤é€š ğŸš•</option>
                    <option value="shop">è³¼ç‰© ğŸ›ï¸</option>
                    <option value="fun">å¨›æ¨‚ ğŸ¡</option>
                    <option value="hotel">ä½å®¿ ğŸ¨</option>
                    <option value="other">å…¶ä»– ğŸ“¦</option>
                </select>
            </div>
            <input type="text" id="m-payer" placeholder="èª°å…ˆä»˜çš„ (ä¾‹: æˆ‘, å°æ˜)">
            
            <div style="display:flex; gap:10px; margin-top:10px;">
                <button class="btn" style="background:#F5F5F5; color:#666; flex:1;" onclick="closeModal('money')">å–æ¶ˆ</button>
                <button class="btn btn-primary" style="flex:1;" onclick="saveMoney()">å„²å­˜</button>
            </div>
        </div>
    </div>

    <!-- åº•éƒ¨å°èˆªåˆ— -->
    <nav class="bottom-nav">
        <button class="nav-item active" onclick="switchView('itinerary')">
            <span class="nav-icon">ğŸ“…</span>è¡Œç¨‹
        </button>
        <button class="nav-item" onclick="switchView('money')">
            <span class="nav-icon">ğŸ’°</span>è¨˜å¸³
        </button>
        <button class="nav-item" onclick="switchView('packing')">
            <span class="nav-icon">ğŸ’</span>æ¸…å–®
        </button>
    </nav>

<script>
    // --- æ ¸å¿ƒè³‡æ–™ ---
    const DB = {
        SETTINGS: 'trip_v2_settings',
        ITINERARY: 'trip_v2_itinerary',
        MONEY: 'trip_v2_money',
        PACKING: 'trip_v2_packing'
    };

    let appData = {
        settings: JSON.parse(localStorage.getItem(DB.SETTINGS)) || null,
        itinerary: JSON.parse(localStorage.getItem(DB.ITINERARY)) || [],
        money: JSON.parse(localStorage.getItem(DB.MONEY)) || [],
        packing: JSON.parse(localStorage.getItem(DB.PACKING)) || []
    };

    let state = {
        dayIndex: 0,
        currentView: 'itinerary'
    };

    // --- å•Ÿå‹•ç¨‹å¼ ---
    window.onload = function() {
        if (!appData.settings) {
            document.getElementById('setup-view').classList.remove('hidden');
        } else {
            initApp();
        }
    };

    function finishSetup() {
        const date = document.getElementById('setup-date').value;
        const days = parseInt(document.getElementById('setup-days').value);
        
        if (!date || !days || days < 1) {
            alert("è«‹è¼¸å…¥æ­£ç¢ºçš„æ—¥æœŸèˆ‡å¤©æ•¸");
            return;
        }

        appData.settings = { startDate: date, days: days };
        localStorage.setItem(DB.SETTINGS, JSON.stringify(appData.settings));
        
        document.getElementById('setup-view').classList.add('hidden');
        initApp();
    }

    function initApp() {
        // é è¨­ä»Šå¤©æ—¥æœŸå°æ‡‰çš„å¤©æ•¸ (å¦‚æœæ—…ç¨‹é€²è¡Œä¸­)
        // é€™è£¡æš«æ™‚é è¨­é¡¯ç¤ºç¬¬ä¸€å¤©ï¼Œè®“é‚è¼¯ç°¡å–®é»
        renderDayTabs();
        renderItinerary();
        renderMoney();
        renderPacking();
    }

    function resetTrip() {
        if(confirm("ç¢ºå®šè¦åˆªé™¤æ‰€æœ‰è³‡æ–™é‡æ–°é–‹å§‹ï¼Ÿ(é€™æœƒæ¸…ç©ºæ‰€æœ‰è¡Œç¨‹èˆ‡è¨˜å¸³)")) {
            localStorage.clear();
            location.reload();
        }
    }

    // --- ç•«é¢åˆ‡æ›èˆ‡æ—¥æœŸ ---
    function switchView(viewName) {
        state.currentView = viewName;
        
        // åˆ‡æ›å…§å®¹å€å¡Š
        document.querySelectorAll('.view-section').forEach(el => el.classList.add('hidden'));
        document.getElementById('view-' + viewName).classList.remove('hidden');

        // åˆ‡æ›åº•éƒ¨æŒ‰éˆ•ç‹€æ…‹
        document.querySelectorAll('.nav-item').forEach(el => el.classList.remove('active'));
        event.currentTarget.classList.add('active');

        // é‡æ–°æ¸²æŸ“è©²é é¢è³‡æ–™
        if(viewName === 'itinerary') renderItinerary();
        if(viewName === 'money') renderMoney();
        // ç¢ºä¿ Day Tabs ç‹€æ…‹æ­£ç¢º
        if(viewName !== 'packing') renderDayTabs();
    }

    function getDisplayDate(idx) {
        const date = new Date(appData.settings.startDate);
        date.setDate(date.getDate() + idx);
        return (date.getMonth() + 1) + '/' + date.getDate();
    }

    function renderDayTabs() {
        const createTabs = (containerId) => {
            const container = document.getElementById(containerId);
            container.innerHTML = '';
            for (let i = 0; i < appData.settings.days; i++) {
                const btn = document.createElement('div');
                btn.className = `day-chip ${i === state.dayIndex ? 'active' : ''}`;
                btn.innerHTML = `Day ${i+1} <span class="date">${getDisplayDate(i)}</span>`;
                btn.onclick = () => {
                    state.dayIndex = i;
                    renderDayTabs(); // æ›´æ–°å…©å€‹é é¢çš„ Tabs ç‹€æ…‹
                    renderItinerary();
                    renderMoney();
                };
                container.appendChild(btn);
            }
        };
        createTabs('day-tabs-itinerary');
        createTabs('day-tabs-money');
    }

    // --- Modal æ§åˆ¶ ---
    function openModal(type) { document.getElementById('modal-' + type).classList.remove('hidden'); }
    function closeModal(type) { document.getElementById('modal-' + type).classList.add('hidden'); }

    // --- 1. è¡Œç¨‹é‚è¼¯ ---
    function saveItinerary() {
        const time = document.getElementById('i-time').value;
        const type = document.getElementById('i-type').value;
        const title = document.getElementById('i-title').value;
        const loc = document.getElementById('i-loc').value;

        if (!time || !title) { alert("è«‹å¡«å¯«æ™‚é–“èˆ‡åç¨±"); return; }

        appData.itinerary.push({
            id: Date.now(),
            dayIdx: state.dayIndex,
            time, type, title, loc
        });
        
        appData.itinerary.sort((a, b) => a.time.localeCompare(b.time));
        localStorage.setItem(DB.ITINERARY, JSON.stringify(appData.itinerary));
        
        closeModal('itinerary');
        renderItinerary();
        
        // æ¸…ç©º
        document.getElementById('i-title').value = '';
        document.getElementById('i-loc').value = '';
    }

    function renderItinerary() {
        const list = document.getElementById('list-itinerary');
        list.innerHTML = '';
        
        const currentItems = appData.itinerary.filter(i => i.dayIdx === state.dayIndex);
        
        if (currentItems.length === 0) {
            list.innerHTML = '<div style="text-align:center; color:#CCC; padding:50px 0;">ğŸƒ æœ¬æ—¥å°šæœªå®‰æ’è¡Œç¨‹</div>';
            return;
        }

        const typeNames = { spot:'æ™¯é»', food:'é¤å»³', transport:'äº¤é€š', flight:'èˆªç­', hotel:'ä½å®¿', shop:'è³¼ç‰©' };

        currentItems.forEach(item => {
            const locHtml = item.loc ? 
                `<a href="https://www.google.com/maps/search/?api=1&query=${encodeURIComponent(item.loc)}" target="_blank" class="location-link">ğŸ“ ${item.loc}</a>` : '';

            list.innerHTML += `
                <div class="card item-row">
                    <div class="item-time">${item.time}</div>
                    <div class="item-main">
                        <span class="tag ${item.type}">${typeNames[item.type] || item.type}</span>
                        <h3 class="item-title">${item.title}</h3>
                        <div class="item-sub">${locHtml}</div>
                    </div>
                    <button class="btn-icon" onclick="delItem('itinerary', ${item.id})">Ã—</button>
                </div>
            `;
        });
    }

    // --- 2. è¨˜å¸³é‚è¼¯ ---
    function saveMoney() {
        const title = document.getElementById('m-title').value;
        const cost = document.getElementById('m-cost').value;
        const type = document.getElementById('m-cat').value;
        const payer = document.getElementById('m-payer').value;

        if (!title || !cost) { alert("è«‹è¼¸å…¥é …ç›®èˆ‡é‡‘é¡"); return; }

        appData.money.push({
            id: Date.now(),
            dayIdx: state.dayIndex,
            title, cost: Number(cost), type, payer
        });

        localStorage.setItem(DB.MONEY, JSON.stringify(appData.money));
        closeModal('money');
        renderMoney();

        document.getElementById('m-title').value = '';
        document.getElementById('m-cost').value = '';
        document.getElementById('m-payer').value = '';
    }

    function renderMoney() {
        const list = document.getElementById('list-money');
        const totalEl = document.getElementById('day-total');
        list.innerHTML = '';

        const currentItems = appData.money.filter(i => i.dayIdx === state.dayIndex);
        let total = 0;

        const typeNames = { food:'é£²é£Ÿ', transport:'äº¤é€š', shop:'è³¼ç‰©', fun:'å¨›æ¨‚', hotel:'ä½å®¿', other:'å…¶ä»–' };

        // åå‘æ’åºï¼Œæœ€æ–°çš„åœ¨ä¸Šé¢
        [...currentItems].reverse().forEach(item => {
            total += item.cost;
            const payerInfo = item.payer ? `<span style="margin-left:5px; color:#90A4AE;">(ç”± ${item.payer} å…ˆä»˜)</span>` : '';
            
            list.innerHTML += `
                <div class="card item-row">
                    <div class="item-main">
                        <span class="tag ${item.type}">${typeNames[item.type] || item.type}</span>
                        <h3 class="item-title">${item.title}</h3>
                        <div class="item-sub">${payerInfo}</div>
                    </div>
                    <div style="text-align:right; display:flex; flex-direction:column; justify-content:space-between; align-items:flex-end;">
                        <div style="font-weight:bold; color:var(--text-main); font-size:1.1rem;">$${item.cost}</div>
                        <button class="btn-icon" style="font-size:1.2rem;" onclick="delItem('money', ${item.id})">Ã—</button>
                    </div>
                </div>
            `;
        });

        if (currentItems.length === 0) list.innerHTML = '<div style="text-align:center; color:#CCC; padding:50px 0;">â˜ï¸ æœ¬æ—¥ç„¡æ¶ˆè²»ç´€éŒ„</div>';
        totalEl.innerText = '$' + total.toLocaleString();
    }

    // --- 3. æ¸…å–®é‚è¼¯ ---
    function addPackItem() {
        const input = document.getElementById('pack-input');
        const val = input.value.trim();
        if(!val) return;
        
        appData.packing.push({ id: Date.now(), text: val, checked: false });
        localStorage.setItem(DB.PACKING, JSON.stringify(appData.packing));
        input.value = '';
        renderPacking();
    }

    function renderPacking() {
        const list = document.getElementById('list-packing');
        list.innerHTML = '';
        
        appData.packing.forEach(item => {
            list.innerHTML += `
                <div class="check-item ${item.checked ? 'checked' : ''}">
                    <input type="checkbox" ${item.checked ? 'checked' : ''} onchange="togglePack(${item.id})">
                    <span style="flex:1;">${item.text}</span>
                    <button class="btn-icon" onclick="delItem('packing', ${item.id})">Ã—</button>
                </div>
            `;
        });
        
        if (appData.packing.length === 0) list.innerHTML = '<div style="text-align:center; color:#DDD; padding:20px;">æ–°å¢ä½ çš„è¡Œææ¸…å–®å§</div>';
    }

    function togglePack(id) {
        const item = appData.packing.find(p => p.id === id);
        if(item) {
            item.checked = !item.checked;
            localStorage.setItem(DB.PACKING, JSON.stringify(appData.packing));
            renderPacking();
        }
    }

    // --- é€šç”¨åˆªé™¤ ---
    function delItem(type, id) {
        if(!confirm("ç¢ºå®šåˆªé™¤æ­¤é …ç›®ï¼Ÿ")) return;

        if (type === 'itinerary') {
            appData.itinerary = appData.itinerary.filter(i => i.id !== id);
            localStorage.setItem(DB.ITINERARY, JSON.stringify(appData.itinerary));
            renderItinerary();
        } else if (type === 'money') {
            appData.money = appData.money.filter(i => i.id !== id);
            localStorage.setItem(DB.MONEY, JSON.stringify(appData.money));
            renderMoney();
        } else if (type === 'packing') {
            appData.packing = appData.packing.filter(i => i.id !== id);
            localStorage.setItem(DB.PACKING, JSON.stringify(appData.packing));
            renderPacking();
        }
    }

</script>
</body>
</html>
